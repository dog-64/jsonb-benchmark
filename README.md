# JsonbBenchmark

Тестирование скорости доступа к полям jsonb в зависимости от рамера json.

Вывод - никакой разницы в разы нет. Всё в пределах погрешности.


## Условия

- Postgres 14.9
- Ubuntu 22.04.2
- Pgbench (14.9 (Ubuntu 14.9-0ubuntu0.22.04.1))
- по [PostgresPro статья](https://habr.com/ru/companies/oleg-bunin/articles/646987/)

На абсолютные показатели смотреть не нужно.
Они на каждом хосте будут свои.
Играют только относительные показатели.

## Виды записей

- table - короткая, 100 байт, помещается в основной таблице
- arch - больше 2К, но до сжатия
- toast - больше 4К, т.е больше 2К даже после сжатия
- toast3 - утроенное поле actors->roles

## Benchmark

Подготовка /единожды

```shell
pgbench -U postgres -i -s 10 imdb
```

Запуск

```shell
./benchmark_5m.sh
```

[v1.sql](v1.sql)

## Select

| Kind   | Tps  | Tps  | Tps  |
|--------|------|------|------|
| Table  | 6504 | 7027 | 6945 |     
| Arch   | 6974 | 7037 | 7028 |     
| Toast  | 6774 | 7141 | 7164 |     
| Toast3 | 6688 | 6135 | 6278 |     

Интересно, что Table  проигрывает Arch.

## Update

| Kind   | Tps  | Tps  | Tps  |
|--------|------|------|------|
| Table  | 1752 | 1929 | 1840 |     
| Arch   | 1866 | 1821 | 1850 |     
| Toast  | 1776 | 1858 | 1864 |     
| Toast3 | 1775 | 1808 | 1818 |     

Тоже, что Table хуже Arch.

