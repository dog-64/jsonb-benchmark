# JsonbBenchmark

Тестирование скорости доступа к полям jsonb.

## Условия

- Postgres 14.9
- Ubuntu 22.04.2
- Pgbench (14.9 (Ubuntu 14.9-0ubuntu0.22.04.1))
- по [PostgresPro статья](https://habr.com/ru/companies/oleg-bunin/articles/646987/)

На абсолютные показатели смотреть не нужно.
Они на каждом хосте будут свои.
Играют только относительные показатели.

## Виды записей

- table - короткая, 100 байт, помещается в основной таблице
- arch - больше 2К, но до сжатия
- toast - больше 4К, т.е больше 2К даже после сжатия
- toast3 - утроенное поле actors->roles

## Benchmark

Подготовка /единожды

```shell
pgbench -U postgres -i -s 10 imdb
```

Запуск

```shell
./benchmark.sh
```

[v1.sql](v1.sql)

| Kind   | Tps    | Tps    | Tps    |
|--------|--------|--------|--------|
| Table  | 225296 | 210615 | 203024 |     
| Arch   | 203688 | 205487 | 195719 |     
| Toast  | 214167 | 216636 | 215531 |     
| Toast3 | 183000 | 186083 | 177693 |     

Как то разница Table-Arch-Toast не впечатляет - от силы 10%. 
